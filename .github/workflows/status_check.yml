# GitHub Action Workflow to periodically check SimplePractice status
# Runs every 5 minutes, includes permissions fix

name: Check SimplePractice Status

on:
  # Run automatically on a schedule (every 5 minutes)
  schedule:
    - cron: '*/5 * * * *' # Changed from */15 to */5

  # Allows running this workflow manually from the Actions tab
  workflow_dispatch:

# Permissions block to allow the workflow to commit back to the repo
permissions:
  contents: write # Grants write permission for repository contents

jobs:
  check_status:
    runs-on: ubuntu-latest # Use the latest available runner

    steps:
      # 1. Check out the repository code
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Specify desired Python version

      # 3. Install dependencies (only 'requests' needed for this script)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 4. Run the Python status check script
      #    This script will generate/update index.html and status.json
      - name: Run status check script
        run: python check_status.py # Make sure your script is named check_status.py

      # 5. Commit and push the updated index.html and status.json
      #    Uses a dedicated action to simplify committing within a workflow
      - name: Commit status files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automated status update" # Commit message
          # Specify the files to add and commit.
          file_pattern: "index.html status.json"
          # Optional: Add user name and email for the commit
          commit_user_name: "GitHub Action Bot"
          commit_user_email: "actions@github.com"

